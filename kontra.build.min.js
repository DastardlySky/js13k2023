/*
 * Kontra.js v2.1.0 (Custom Build on 2016-08-14) | MIT
 * Build: --files qLite,assets,gameLoop,quadtree,sprite,keyboard
 */
function qFactory(t,e){function n(t,e,i){var r;if(t)if(a(t))for(r in t)"prototype"==r||"length"==r||"name"==r||t.hasOwnProperty&&!t.hasOwnProperty(r)||e.call(i,t[r],r);else if(t.forEach&&t.forEach!==n)t.forEach(e,i);else if(c(t))for(r=0;r<t.length;r++)e.call(i,t[r],r);else for(r in t)t.hasOwnProperty(r)&&e.call(i,t[r],r);return t}function i(t){return t}function r(t){return d(t)}function o(t){var e=h(),i=0,r=c(t)?[]:{};return n(t,function(t,n){i++,u(t).then(function(t){r.hasOwnProperty(n)||(r[n]=t,--i||e.resolve(r))},function(t){r.hasOwnProperty(n)||e.reject(t)},function(t){r.hasOwnProperty(n)||e.notify(t)})}),0===i&&e.resolve(r),e.promise}var s={}.toString,a=function(t){return"function"==typeof t},c=function(t){return"[object Array]"===s.call(t)},h=function(){var n,o,s=[];return o={resolve:function(e){if(s){var i=s;s=void 0,n=u(e),i.length&&t(function(){for(var t,e=0,r=i.length;e<r;e++)t=i[e],n.then(t[0],t[1],t[2])})}},reject:function(t){o.resolve(f(t))},notify:function(e){if(s){var n=s;s.length&&t(function(){for(var t,i=0,r=n.length;i<r;i++)t=n[i],t[2](e)})}},promise:{then:function(t,o,c){var u=h(),d=function(n){try{u.resolve((a(t)?t:i)(n))}catch(r){u.reject(r),e(r)}},f=function(t){try{u.resolve((a(o)?o:r)(t))}catch(n){u.reject(n),e(n)}},l=function(t){try{u.notify((a(c)?c:i)(t))}catch(n){e(n)}};return s?s.push([d,f,l]):n.then(d,f,l),u.promise},"catch":function(t){return this.then(null,t)},"finally":function(t){function e(t,e){var n=h();return e?n.resolve(t):n.reject(t),n.promise}function n(n,r){var o=null;try{o=(t||i)()}catch(s){return e(s,!1)}return o&&a(o.then)?o.then(function(){return e(n,r)},function(t){return e(t,!1)}):e(n,r)}return this.then(function(t){return n(t,!0)},function(t){return n(t,!1)})}}}},u=function(e){return e&&a(e.then)?e:{then:function(n){var i=h();return t(function(){i.resolve(n(e))}),i.promise}}},d=function(t){var e=h();return e.reject(t),e.promise},f=function(n){return{then:function(i,o){var s=h();return t(function(){try{s.resolve((a(o)?o:r)(n))}catch(t){s.reject(t),e(t)}}),s.promise}}},l=function(n,o,s,c){var f,l=h(),p=function(t){try{return(a(o)?o:i)(t)}catch(n){return e(n),d(n)}},v=function(t){try{return(a(s)?s:r)(t)}catch(n){return e(n),d(n)}},m=function(t){try{return(a(c)?c:i)(t)}catch(n){e(n)}};return t(function(){u(n).then(function(t){f||(f=!0,l.resolve(u(t).then(p,v,m)))},function(t){f||(f=!0,l.resolve(v(t)))},function(t){f||l.notify(m(t))})}),l.promise};return{defer:h,reject:d,when:l,all:o}}var kontra=function(t,e){"use strict";return t.init=function(n){if(n=n||{},t.isString(n.canvas))this.canvas=e.getElementById(n.canvas);else if(t.isCanvas(n.canvas))this.canvas=n.canvas;else if(this.canvas=e.getElementsByTagName("canvas")[0],!this.canvas){var i=new ReferenceError("No canvas element found.");return void t.logError(i,"You must provide a canvas element for the game.")}this.context=this.canvas.getContext("2d"),this.game={width:this.canvas.width,height:this.canvas.height}},t.logError=function(t,e){console.error("Kontra: "+e+"\n\t"+t.stack)},t.noop=function(){},t.isString=function(t){return"string"==typeof t},t.isNumber=function(t){return"number"==typeof t},t.isImage=function(t){return t instanceof HTMLImageElement},t.isCanvas=function(t){return t instanceof HTMLCanvasElement},t}(kontra||{},document);window.q=qFactory(function(t){setTimeout(function(){t()},0)},function(t){console.error("qLite: "+t.stack)});var kontra=function(t,e){var n=/(jpeg|jpg|gif|png)$/,i=/(wav|mp3|ogg|aac|m4a)$/;t.images={},t.audios={},t.data={},t.assetPaths={images:"",audios:"",data:""};var r=new Audio;return t.canUse=t.canUse||{},t.canUse.wav="",t.canUse.mp3=r.canPlayType("audio/mpeg;").replace(/^no$/,""),t.canUse.ogg=r.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),t.canUse.aac=r.canPlayType("audio/aac;").replace(/^no$/,""),t.canUse.m4a=(r.canPlayType("audio/x-m4a;")||t.canUse.aac).replace(/^no$/,""),t.getAssetExtension=function(t){return t.substr((~-t.lastIndexOf(".")>>>0)+2)},t.getAssetType=function(t){var e=this.getAssetExtension(t);return e.match(n)?"Image":e.match(i)?"Audio":"Data"},t.getAssetName=function(t){return t.replace(/\.[^\/.]+$/,"")},t.loadAssets=function(){var n,i,r=e.defer(),o=[],s=0,a=arguments.length;arguments.length||r.resolve();for(var c,h=0;c=arguments[h];h++)i=Array.isArray(c)?c[0]:c,n=this.getAssetType(i),function(e){o.push(e.promise),t["load"+n](i).then(function(){e.resolve(),r.notify({loaded:++s,total:a})},function(t){e.reject(t)})}(e.defer());return e.all(o).then(function(){r.resolve()},function(t){r.reject(t)}),r.promise},t.loadImage=function(n){var i=e.defer(),r=this.getAssetName(n),o=new Image;return n=this.assetPaths.images+n,o.onload=function(){t.images[r]=t.images[n]=this,i.resolve(this)},o.onerror=function(){i.reject("Unable to load image "+n)},o.src=n,i.promise},t.loadAudio=function(n){var i,r,o,s,a=e.defer();Array.isArray(n)||(n=[n]);for(var c=0;i=n[c];c++)if(this.canUse[this.getAssetExtension(i)]){o=i;break}return o?(r=this.getAssetName(o),s=new Audio,i=this.assetPaths.audios+o,s.addEventListener("canplay",function(){t.audios[r]=t.audios[i]=this,a.resolve(this)}),s.onerror=function(){a.reject("Unable to load audio "+i)},s.src=i,s.preload="auto",s.load()):a.reject("Browser cannot play any of the audio formats provided"),a.promise},t.loadData=function(n){var i=e.defer(),r=new XMLHttpRequest,o=this.getAssetName(n),s=this.assetPaths.data+n;return r.addEventListener("load",function(){if(200!==r.status)return void i.reject(r.responseText);try{var e=JSON.parse(r.responseText);t.data[o]=t.data[s]=e,i.resolve(e)}catch(n){var a=r.responseText;t.data[o]=t.data[s]=a,i.resolve(a)}}),r.open("GET",s,!0),r.send(),i.promise},t}(kontra||{},q),kontra=function(t,e){"use strict";return t.timestamp=function(){return e.performance&&e.performance.now?function(){return e.performance.now()}:function(){return(new Date).getTime()}}(),t.gameLoop=function(e){var n=Object.create(t.gameLoop.prototype);return n.init(e),n},t.gameLoop.prototype={init:function(e){if(e=e||{},"function"!=typeof e.update||"function"!=typeof e.render){var n=new ReferenceError("Required functions not found");return void t.logError(n,"You must provide update() and render() functions to create a game loop.")}this.isStopped=!1,this._accumulator=0,this._delta=1e3/(e.fps||60),this._step=1/(e.fps||60),this.update=e.update,this.render=e.render,e.clearCanvas===!1&&(this._clearCanvas=t.noop)},start:function(){this._last=t.timestamp(),this.isStopped=!1,requestAnimationFrame(this._frame.bind(this))},stop:function(){this.isStopped=!0,cancelAnimationFrame(this._rAF)},_frame:function(){if(this._rAF=requestAnimationFrame(this._frame.bind(this)),this._now=t.timestamp(),this._dt=this._now-this._last,this._last=this._now,!(this._dt>1e3)){for(this._accumulator+=this._dt;this._accumulator>=this._delta;)this.update(this._step),this._accumulator-=this._delta;this._clearCanvas(),this.render()}},_clearCanvas:function(){t.context.clearRect(0,0,t.game.width,t.game.height)}},t}(kontra||{},window),kontra=function(t,e){"use strict";return t.quadtree=function(e){var n=Object.create(t.quadtree.prototype);return n.init(e),n},t.quadtree.prototype={init:function(e){e=e||{},this.depth=e.depth||0,this.maxDepth=e.maxDepth||3,this.maxObjects=e.maxObjects||25,this.isBranchNode=!1,this.parentNode=e.parentNode,this.bounds=e.bounds||{x:0,y:0,width:t.game.width,height:t.game.height},this.objects=[],this.subnodes=[]},clear:function(){if(this.isBranchNode)for(var t=0;t<4;t++)this.subnodes[t].clear();this.isBranchNode=!1,this.objects.length=0},get:function(t){for(var e,n,i=this,r=[];i.subnodes.length&&this.isBranchNode;){e=this._getIndex(t);for(var o=0,s=e.length;o<s;o++)n=e[o],r.push.apply(r,this.subnodes[n].get(t));return r}return i.objects},add:function(){for(var t,e,n,i=0,r=arguments.length;i<r;i++)if(e=arguments[i],Array.isArray(e))this.add.apply(this,e);else if(this.subnodes.length&&this.isBranchNode)this._addToSubnode(e);else if(this.objects.push(e),this.objects.length>this.maxObjects&&this.depth<this.maxDepth){for(this._split(),t=0;n=this.objects[t];t++)this._addToSubnode(n);this.objects.length=0}},_addToSubnode:function(t){for(var e=this._getIndex(t),n=0,i=e.length;n<i;n++)this.subnodes[e[n]].add(t)},_getIndex:function(t){var e=[],n=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,r=t.y<i&&t.y+t.height>=this.bounds.y,o=t.y+t.height>=i&&t.y<this.bounds.y+this.bounds.height;return t.x<n&&t.x+t.width>=this.bounds.x&&(r&&e.push(0),o&&e.push(2)),t.x+t.width>=n&&t.x<this.bounds.x+this.bounds.width&&(r&&e.push(1),o&&e.push(3)),e},_split:function(){if(this.isBranchNode=!0,!this.subnodes.length)for(var e=this.bounds.width/2|0,n=this.bounds.height/2|0,i=0;i<4;i++)this.subnodes[i]=t.quadtree({bounds:{x:this.bounds.x+(i%2===1?e:0),y:this.bounds.y+(i>=2?n:0),width:e,height:n},depth:this.depth+1,maxDepth:this.maxDepth,maxObjects:this.maxObjects,parentNode:this})},render:function(){if((this.objects.length||0===this.depth||this.parentNode&&this.parentNode.isBranchNode)&&(t.context.strokeStyle="red",t.context.strokeRect(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height),this.subnodes.length))for(var e=0;e<4;e++)this.subnodes[e].render()}},t}(kontra||{}),kontra=function(t,e,n){"use strict";return t.vector=function(e){var n=Object.create(t.vector.prototype);return n.init(e),n},t.vector.prototype={init:function(t){return t=t||{},this.x=t.x||0,this.y=t.y||0,this},add:function(t,e){this.x+=(t.x||0)*(e||1),this.y+=(t.y||0)*(e||1)},clamp:function(t,i,r,o){this._xMin=t!==n?t:-(1/0),this._xMax=r!==n?r:1/0,this._yMin=i!==n?i:-(1/0),this._yMax=o!==n?o:1/0,this._x=this.x,this._y=this.y,Object.defineProperties(this,{x:{get:function(){return this._x},set:function(t){this._x=e.min(e.max(t,this._xMin),this._xMax)}},y:{get:function(){return this._y},set:function(t){this._y=e.min(e.max(t,this._yMin),this._yMax)}}})}},t.sprite=function(e){var n=Object.create(t.sprite.prototype);return n.init(e),n},t.sprite.prototype={init:function(e){e=e||{},this.position=(this.position||t.vector()).init({x:e.x,y:e.y}),this.velocity=(this.velocity||t.vector()).init({x:e.dx,y:e.dy}),this.acceleration=(this.acceleration||t.vector()).init({x:e.ddx,y:e.ddy});for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);this.timeToLive=e.timeToLive||0,this.context=e.context||t.context,t.isImage(e.image)||t.isCanvas(e.image)?(this.image=e.image,this.width=e.image.width,this.height=e.image.height,this.advance=this._advanceSprite,this.draw=this._drawImage):e.animations?(this.animations=e.animations,this.currentAnimation=e.animations[Object.keys(e.animations)[0]],this.width=this.currentAnimation.width,this.height=this.currentAnimation.height,this.advance=this._advanceAnimation,this.draw=this._drawAnimation):(this.color=e.color,this.width=e.width,this.height=e.height,this.advance=this._advanceSprite,this.draw=this._drawRect)},get x(){return this.position.x},get y(){return this.position.y},get dx(){return this.velocity.x},get dy(){return this.velocity.y},get ddx(){return this.acceleration.x},get ddy(){return this.acceleration.y},set x(t){this.position.x=t},set y(t){this.position.y=t},set dx(t){this.velocity.x=t},set dy(t){this.velocity.y=t},set ddx(t){this.acceleration.x=t},set ddy(t){this.acceleration.y=t},isAlive:function(){return this.timeToLive>0},collidesWith:function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y},update:function(t){this.advance(t)},render:function(){this.draw()},playAnimation:function(t){this.currentAnimation=this.animations[t]},_advanceSprite:function(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.timeToLive--},_advanceAnimation:function(t){this._advanceSprite(t),this.currentAnimation.update(t)},_drawRect:function(){this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height)},_drawImage:function(){this.context.drawImage(this.image,this.x,this.y)},_drawAnimation:function(){this.currentAnimation.render({context:this.context,x:this.x,y:this.y})}},t}(kontra||{},Math),kontra=function(t,e){"use strict";function n(t){return"number"==typeof t.which?t.which:t.keyCode}function i(t){var e=[];t=t.trim().replace("++","+plus");for(var n,i=0;n=p[i];i++)t.indexOf(n)!==-1&&(e.push(n),t=t.replace(n,""));return t=t.replace(/\+/g,"").toLowerCase(),f[t]?e.push("shift+"+f[t]):t&&e.push(t),e.join("+")}function r(t){for(var e,i=[],r=0;e=p[r];r++)t[e+"Key"]&&i.push(e);var o=u[n(t)];return i.indexOf(o)===-1&&i.push(o),i.join("+")}function o(t){for(var e,n=r(t),i=0,o=n.split("+");e=o[i];i++)h[e]=!0;c[n]&&c[n](t,n)}function s(t){var e=u[n(t)];h[e]=!1,l[e]&&(h[l[e]]=!1)}function a(t){h={}}for(var c={},h={},u={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"leftwindow",92:"rightwindow",93:"select",144:"numlock",145:"scrolllock",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},d=0;d<26;d++)u[65+d]=String.fromCharCode(65+d).toLowerCase();for(d=0;d<10;d++)u[48+d]=""+d;for(d=1;d<20;d++)u[111+d]="f"+d;for(d=0;d<10;d++)u[96+d]="numpad"+d;var f={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\",plus:"="},l={leftwindow:"meta",select:"meta"},p=["meta","ctrl","alt","shift"];return e.addEventListener("keydown",o),e.addEventListener("keyup",s),e.addEventListener("blur",a),t.keys={},t.keys.bind=function(e,n){if("function"!=typeof n){var r=new SyntaxError("Invalid function.");return void t.logError(r,"You must provide a function as the second parameter.")}e=Array.isArray(e)?e:[e];for(var o,s=0;o=e[s];s++){var a=i(o);c[a]=n}},t.keys.unbind=function(t){t=Array.isArray(t)?t:[t];for(var e,n=0;e=t[n];n++){var r=i(e);c[r]=void 0}},t.keys.pressed=function(t){var e=i(t),n=!0;t=e.split("+");for(var r,o=0;r=t[o];o++)n=n&&!!h[r];return n},t}(kontra||{},window);